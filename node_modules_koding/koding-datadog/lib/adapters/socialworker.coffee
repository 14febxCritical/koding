{ argv }  = require 'optimist'
KONFIG    = require('koding-config-manager').load("main.#{argv.c}")
Timer     = require '../timer'
DogStatsD = require '../dogstatsd'

module.exports = socialWorker = {

  prefix : 'socialWorker'


  populateTags : (tags) ->

    tags ?= []
    tags.push "version:#{KONFIG.version}"

    return tags


  generateMetricName : (opts) ->

    { method } = opts
    { constructorName, method, type } = method

    return "#{@prefix}.#{constructorName}.#{method}.#{type}"


  sendMetrics : (opts) ->

    tags            = socialWorker.populateTags()
    metricName      = socialWorker.generateMetricName opts
    memoryUsage     = process.memoryUsage()
    dogStatsDClient = DogStatsD.getClient()

    dogStatsDClient.gauge "#{metricName}.memory.rss", memoryUsage.rss, tags
    dogStatsDClient.gauge "#{metricName}.memory.heapTotal", memoryUsage.heapTotal, tags
    dogStatsDClient.gauge "#{metricName}.memory.heapUsed", memoryUsage.heapUsed, tags

}

