# author: devrim@koding
# 1/7/2013
# update: 6/22/2014

fs              = require 'fs'
{extend}        = require 'underscore'


class Config
  @load: (name)->

    # DEPRECATION NOTICE. MAKE YOUR MODULES USE ./install/BUILD_CONFIG.json
    # code will assume correct config file is made available to them on build step.

    try
      a = fs.readFileSync(__dirname + "/../../install/BUILD_DATA/BUILD_CONFIG.json")
      return JSON.parse a
    catch err
      try
        a = fs.readFileSync "/BUILD_DATA/BUILD_CONFIG.json"
        return JSON.parse a
      catch err
        console.log "COULDN'T FIND BUILD_CONFIG.json here ./install or / - did you ./build -?"
        console.log "exiting now.",err
        process.exit()


  @printJson:(name)->
    console.log JSON.stringify @load name


  getConfigScriptTag:(mixin={})->
    config = extend {}, @client.runtimeOptions, mixin
    """
    <script>var KD = #{JSON.stringify {config}};</script>
    """

module.exports = Config
