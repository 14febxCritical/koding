# author: devrim@koding
# 1/7/2013
# update: 6/22/2014

fs              = require 'fs'
{extend}        = require 'underscore'


class Config
  @load: (name)->

    # DEPRECATION NOTICE. MAKE YOUR MODULES USE ./install/BUILD_CONFIG.json
    # code will assume correct config file is made available to them on build step.
    if process.env['KODING_BUILD_DATA_PATH']
      configPath = process.env['KODING_BUILD_DATA_PATH']+"/BUILD_CONFIG.json"
    else
      configPath = require('path').join __dirname, "/../../install/BUILD_DATA/BUILD_CONFIG.json"

    try
      a = fs.readFileSync configPath
      a = JSON.parse a
      a.getConfigScriptTag = (mixin={})->
        config = extend {}, @client.runtimeOptions, mixin
        """
        <script>var KD = #{JSON.stringify {config}};</script>
        """

      return a
    catch err
      console.log "COULDN'T FIND BUILD_CONFIG.json at #{configPath} (on prod check: env KODING_BUILD_DATA_PATH)"
      console.log "exiting now.",err
      process.exit()


  @printJson:(name)->
    console.log JSON.stringify @load name



module.exports = Config
