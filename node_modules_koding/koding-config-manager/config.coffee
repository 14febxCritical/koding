_  = require 'underscore'

KONFIG = {}

try
  module.exports = KONFIG = JSON.parse process.env.KONFIG_JSON
catch err
  console.error 'error: could not parse KONFIG_JSON environment variable'
  console.error err
  process.exit 1

KONFIG.getConfigScriptTag = (mixin = {}) ->
  config = _.extend {}, @client.runtimeOptions, mixin
  """
  <script>var KD = #{JSON.stringify {config}};</script>
  """
