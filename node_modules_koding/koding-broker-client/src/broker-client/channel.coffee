{EventEmitter} = require './microemitter'

module.exports = class Channel extends EventEmitter

  constructor:(@name, @routingKeyPrefix, {@isReadOnly, @isSecret, @isExclusive})->
    @eventRegister = []  if @isExclusive
    @trackListener = (event, listener)=>
      @eventRegister.push { event, listener }
      @privateChannel?.on event, listener

  publish:(rest...)->
    @emit 'publish', rest...  unless @isReadOnly

  close:-> @emit 'close'

  cycle:-> @emit 'cycle'

  pipe:(channel)-> @on 'message', (message)-> channel.emit 'message', message

  setAuthenticationInfo:(@authenticationInfo)->

  getAuthenticationInfo:-> @authenticationInfo

  isListeningTo:(event)->
    listeners = @_events?[event]
    listeners and (Object.keys listeners).length > 0

  setSecretName:(@secretName)->

  bound: require 'koding-bound'