module.exports = (serviceKey) ->
  last = null
  serviceInfo = serviceKey.split('.').reduce (acc, edge, i)->
    unless i % 2 then last = edge
    else acc[last] = edge
    return acc
  , {}
  serviceInfo.loadBalancing = /\.loadBalancing$/.test serviceKey
  isValidKey  = serviceInfo.serviceGenericName? and
                serviceInfo.serviceUniqueName?
  throw {
    message: 'Bad service key!'
    serviceKey
    serviceInfo
  }  unless isValidKey

  return serviceInfo