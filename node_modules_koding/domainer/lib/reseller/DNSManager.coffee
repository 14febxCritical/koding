request = require 'request'

module.exports = class DNSManager

  registerNewRecordToProxy:(params, callback)->

    requestMethod = if params.shouldUpdate is yes then 'put' else 'post'

    postData =
      mode          : params.mode
      hostnameAlias : params.hostnameAlias

    options =
      method  : requestMethod
      uri     : "http://kontrol.in.koding.com/domains/#{params.domainName}"
      body    : JSON.stringify postData

      headers : {'content-type': 'application/json'}

    request[requestMethod] options, (error, response, body) =>
      return callback error if error
      callback null, JSON.parse body
      """
      if error
        console.log "ERROR", error
        res.send 401, JSON.stringify {error: "unauthorized - error code 2"}
      else if response.statusCode is 200
        callback JSON.parse body
      """


  removeDNSRecordFromProxy:(params,callback)->
    postData =
      mode     : params.mode
      username : params.username

    options =

      method : 'DELETE'
      uri     : "http://kontrol.in.koding.com/domains/#{params.domainName}"
      body    : JSON.stringify postData
      headers : {'content-type': 'application/json'}

    request.del options, (error, response, body) =>
      return callback error if error
      callback null, JSON.parse body
