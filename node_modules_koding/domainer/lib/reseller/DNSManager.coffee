request = require 'request'

module.exports = class DNSManager

  registerNewRecordToProxy:(newRecord, callback)->

    postData =
      mode          : newRecord.mode
      hostnameAlias : newRecord.hostnameAlias

    options =
      method  : 'POST'
      uri     : "http://kontrol.in.koding.com/domains/#{newRecord.domainName}"
      body    : JSON.stringify postData

      headers : {'content-type': 'application/json'}

    request.post options, (error, response, body) =>
      if error
        console.log "ERROR", error
        res.send 401, JSON.stringify {error: "unauthorized - error code 2"}
      else if response.statusCode is 200
        callback JSON.parse body


  removeDNSRecordFromProxy:(record,callback)->
    postData =
      mode     : record.mode
      username : record.username

    options =

      method : 'DELETE'
      uri     : "http://kontrol.in.koding.com/domains/#{record.domainName}"
      body    : JSON.stringify postData
      headers : {'content-type': 'application/json'}

    request.del options, (error, response, body) =>
      if error
        console.log "ERROR", error
        res.send 401, JSON.stringify {error: "unauthorized - error code 2"}
      else if response.statusCode is 200
        callback JSON.parse body
        
