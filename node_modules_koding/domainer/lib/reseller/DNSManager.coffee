request = require 'request'

module.exports = class DNSManager

  registerNewRecordToProxy:(newRecord, callback)->

    postData =
      mode     : newRecord.mode
      username : newRecord.username

    options =
      method  : 'POST'
<<<<<<< HEAD
      uri     : "http://kontrol.in.koding.com/domains/#{newRecord.domainName}"
      body    : JSON.stringify postData
=======
      uri     : "http://kontrol.in.koding.com/domains/#{newRecord.domainAddress}"
      body    : JSON.stringify postData
>>>>>>> d759af228d8303e76de50936b023808ec9be8df9
      headers : {'content-type': 'application/json'}

    request.post options, (error, response, body) =>
      if error
        console.log "ERROR", error
        res.send 401, JSON.stringify {error: "unauthorized - error code 2"}
      else if response.statusCode is 200
        callback JSON.parse body


  removeDNSRecordFromProxy:(record,callback)->
    postData =
      mode     : record.mode
      username : record.username

    options =
<<<<<<< HEAD
      method : 'DELETE'
      uri     : "http://kontrol.in.koding.com/domains/#{record.domainName}"
      body    : JSON.stringify postData
      headers : {'content-type': 'application/json'}
=======
      method  : 'DELETE'
      uri     : "http://kontrol.in.koding.com/domains/#{record.domainAddress}"
      headers : {'content-type': 'application/json'}
>>>>>>> d759af228d8303e76de50936b023808ec9be8df9

    request.del options, (error, response, body) =>
      console.log body
      if error
        console.log "ERROR", error
        res.send 401, JSON.stringify {error: "unauthorized - error code 2"}
      else if response.statusCode is 200
        callback JSON.parse body
        
