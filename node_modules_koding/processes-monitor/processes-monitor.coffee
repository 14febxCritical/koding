module.exports = 
  start : (options) ->
    {interval,name} = options
    if process.send
      setInterval ->
        # communicating to parent supervisor
        data =
          "process-monitor" : yes
          name   : name
          mem    : 
            rss       : Math.floor((process.memoryUsage().rss)/(1024*1024))
            heapTotal : Math.floor((process.memoryUsage().heapTotal)/(1024*1024))
            heapUsed  : Math.floor((process.memoryUsage().heapUsed)/(1024*1024))
            unit      : 'MB'            
          uptime : process.uptime()
        process.send? data

        if options.limits?.memory < data.mem.rss
          options.limits.callback "Excess Memory usage",data

      ,interval ? 1000
    else
      console.log "[LOAD-BALANCER][WARN] Process is not forked, parent communication will not be possible."
