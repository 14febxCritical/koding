redis = require 'redis'
KiteDataStoreBaseAdapter = require './datastorebaseadapter'

module.exports = class MergenAdapter extends KiteDataStoreBaseAdapter
  constructor: (@config)->
    @clients = []
    @deadclients = []
    for addr in @config
      [host, port] = addr.split ':'
      # TODO: this should add to dead servers, if cant connect..
      @clients.push(redis.createClient(port, host, {no_ready_check:true, should_buffer:false}))

  getClient:->
    # TODO: this should fallback if can't connect etc...
    @clients[0]

  set:(key, value, callback)->
    @getClient().set key, value, callback

  get: (key, callback)->
    @getClient().get key, callback

  delete: (key, callback)->
    @getClient().delete key, callback
