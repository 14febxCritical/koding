falafel = require 'falafel'
{argv} = require 'optimist'

compile =require './compile'

compileAll =(source)->
  falafel source, (node)->
    if node.type is 'Literal'
    	console.log node.source()
      node.update compile node.source()

module.exports = (src, magicWord="pistachio")->
  falafel src, (node)->
    if (node.type is 'Property' and node.key.name is magicWord) or\
       (node.type is 'AssignmentExpression' and node.left.property?.name is magicWord)
      node.update compileAll node.source()