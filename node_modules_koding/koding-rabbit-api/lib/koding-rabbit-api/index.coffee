http = require 'http'

apiGet = (method, arguments, callback) ->
  options =
    host: 'web0.dev.system.aws.koding.com'
    port: 15672
    auth: 'kite-manager:Zwh4IGCDHfqE1MQ'
    path: '/api/' + method
    method: 'GET'

  req = http.request options, (res) ->
    res.setEncoding 'utf8'
    res.on 'data', (chunk) ->
      callback null, chunk

  req.on 'error', (e) ->
    callback e, null

  req.end()

apiSet = (method, arguments, callback) ->
  options =
    host: 'web0.dev.system.aws.koding.com'
    port: 15672
    auth: 'kite-manager:Zwh4IGCDHfqE1MQ'
    path: '/api/' + method
    method: 'PUT'
    headers: {'content-type': 'application/json'}

  req = http.request options, (res) ->
    res.setEncoding 'utf8'
    callback null, {}

  req.on 'error', (e) ->
    console.log e
    callback e, null

  req.write JSON.stringify arguments
  req.end()

rabbitAPI = 
  get: apiGet
  set: apiSet

module.exports = rabbitAPI