# this is just an example for a client
{Kite, KiteEventListener} = require 'koding-kite'

{kite} = require 'koding-kite'

eventListener = new KiteEventListener
eventListener.on "REGISTER", (kite)->
  console.log "received kite event register", kite

eventListener.on "DEREGISTER", (kite)->
  console.log "received kite event deregister", kite


options = new kite.Options {
                Kitename:    "application",
                Version:     "0.0.1",
                Port:        9998,
                Region:      "localhost",
                Environment: "development",
                Username:    "devrim",
        }

k = new Kite options
k.Start ()->
  k.Kontrol.GetKites {name: "mathworker"}, eventListener, (err, kites)->
      throw "Error while getting kite list #{err}" if err
      throw "no available kite worker" if not Array.isArray(kites) or kites.length is 0
      # connecting to first avail kite
      mathworker = kites[0]
      mathworker.on 'connected', ()->
        setInterval ()->
          value = Math.random() * 100
          mathworker.Call "square", value, (r)->
            [err, data] = r.Args
            if err
              console.log "received error from kite ", err
              return
            console.log "square of #{value} is #{data}"
        , 5000
      mathworker.Dial()
