# this is just an example for a client

{Client} = require 'koding-kite'

k = new Client
k.on 'connected', ()->
    console.log "connected...."
    k.getKites (err, kites)->
      if err or not Array.isArray(kites) or kites.length == 0
        throw "no available kite worker"
      # connecting to first avail kite
      kite = kites[0]
      console.log ">>>>", kite.kite.publicIP
      url = "ws://#{kite.kite.publicIP}:#{kite.kite.port}/dnode"
      console.log url
      #
      # now we connect to kite worker..
      authentication =
        type: 'token'
        key: kite.token
      mathworker = new Client {}, url
      mathworker.on 'connected', ()->
        setInterval ()->
          value = Math.random() * 100
          console.log "sending #{value} to mathworker"
          mathworker.callRemote "square", value, authentication, (err, data)->
            console.log "response from mathworker", err, data
        , 5000
      mathworker.connect()
k.connect()