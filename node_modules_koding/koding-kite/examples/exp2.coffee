# this is just an example for a client
{Client, Environment} = require 'koding-kite'

# sample of a client exposing functions to worker
class MathClient extends Client
  log: ()->
    console.log "log function called"

environment = new Environment username: "devrim"

k = new Client environment: environment
k.on 'connected', ()->
    console.log "connected to kontrol...."
    k.getKites {name:"mathworker", username:"devrim", kiteClass: MathClient}, (err, kites)->
      throw "Error while getting kite list #{err}" if err
      throw "no available kite worker" if not Array.isArray(kites) or kites.length == 0

      # connecting to first avail kite
      mathworker = kites[0]
      mathworker.on 'connected', ()->
        #setInterval ()->
        value = Math.random() * 100
        console.log "sending #{value} to mathworker"
        mathworker.callRemote "square", value, (err, data)->
          console.log "response from mathworker", err, data
        #, 5000
      mathworker.connect()
k.connect()