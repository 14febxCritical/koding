# this is just an example for a client
{Kontrol, Environment, KiteEventListener} = require 'koding-kite'
environment = new Environment username: "devrim"

eventListener = new KiteEventListener
eventListener.on "REGISTER", (kite)->
  console.log "received kite event register", kite

eventListener.on "DEREGISTER", (kite)->
  console.log "received kite event deregister", kite

kontrol = new Kontrol environment: environment
kontrol.on 'connected', ()->
  kontrol.getKites {name:"mathworker"}, eventListener, (err, kites)->
    throw "Error while getting kite list #{err}" if err
    throw "no available kite worker" if not Array.isArray(kites) or kites.length is 0
    # connecting to first avail kite
    mathworker = kites[0]
    mathworker.on 'connected', ()->
      setInterval ()->
        value = Math.random() * 100
        mathworker.callRemote "square", value, (request)->
          [err, data] = request.args
          if err
            console.log "received error from kite ", err
            return
          console.log "square of #{value} is #{data}"
        , 100
      , 5000
    mathworker.connect()
