Bongo = require 'bongo'

module.exports =-> bongoMixin.call Bongo.prototype

### where bongo mixin looks like: ###

bongoMixin = ->
  Bongo.prototype.on 'newInstance', (instance)-> 
    {Relationship} = require 'jraphical'
    Relationship.addBongo instance
  oldHandleEvent = @handleEvent
  @handleEvent = (rest...)->
    if arguments[2]?
      events = ["RelationshipSaved", "RelationshipRemoved"]
      if events.indexOf(arguments[2]) > -1

        data =  { event : arguments[2], data : arguments[3]}
        @mq.emit 'a-relationshipExchange', "", JSON.stringify(data), autoDelete: no

    oldHandleEvent.apply this, rest
  