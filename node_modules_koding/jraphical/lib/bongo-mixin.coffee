Bongo = require 'bongo'

module.exports =-> bongoMixin.call Bongo.prototype

### where bongo mixin looks like: ###

bongoMixin = ->
  Bongo.prototype.on 'newInstance', (instance)-> 
    {Relationship} = require 'jraphical'
    Relationship.addBongo instance
  oldHandleEvent = @handleEvent
  @handleEvent = (rest...)->
    eventName = rest[2]
    if eventName?
      events = ["RelationshipSaved", "RelationshipRemoved"]
      if eventName in events
        data =  { event : eventName, payload : rest[3]}
        @mq.emit 'a-relationshipExchange', "", JSON.stringify(data), autoDelete: no

    oldHandleEvent.apply this, rest
  