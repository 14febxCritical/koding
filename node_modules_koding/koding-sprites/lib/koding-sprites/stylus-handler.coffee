{ basename } = require 'path'

SpriteImage = require './sprite-image.coffee'

module.exports = (layout, _, spriteSrc, options, next) ->
  spriteKey = basename spriteSrc, '.sprite.png'
  images = @layouts[spriteKey] = {}
  layout.images.forEach (image) ->
    imageKey = basename image.path, '.png'
    images[imageKey] = new SpriteImage {
      name      : imageKey
      props     : image
      sprite    :
        width   : layout.width
        height  : layout.height
        src     : spriteSrc
      options
    }
  next()