{ basename } = require 'path'

SpriteImage = require './sprite-image.coffee'

module.exports = (layouts, isRetina) -> (layout, _, spriteSrc, _1, next) ->
  spriteKey = basename spriteSrc, '.sprite.png'
  images = layouts[spriteKey] ?= {}
  layout.images.forEach (image) ->
    imageKey = basename image.path, '.png'
    images[imageKey] = new SpriteImage
      name      : imageKey
      props     : image
      isRetina  : isRetina
      sprite    :
        width   : layout.width
        height  : layout.height
        src     : spriteSrc
  next()
