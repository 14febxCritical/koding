fs = require 'fs'
coffee = require 'coffee-script'
{parser, uglify} = require 'uglify-js'

getJs =->
  coffee.compile fs.readFileSync('./lib/pistachio.coffee', 'utf8')

compress =(src)->
  ast = parser.parse src
  ast = uglify.ast_mangle ast
  ast = uglify.ast_squeeze ast
  uglify.gen_code ast

option '-c', '--compress', 'Do you want to compress it?' 

task 'build', 'build pistachio for inclusion in a browser', (options)->
  src = getJs()
  if options.compress
    src = compress src
  fs.writeFileSync './browser/pistachio.js', src
