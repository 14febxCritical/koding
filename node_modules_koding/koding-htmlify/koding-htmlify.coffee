# GG: Taken and modified from http://stackoverflow.com/a/7138764/1370271
module.exports = (content, options={})->
  # http://, https://, ftp://
  urlPattern = /\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim
  # www. sans http:// or https://
  pseudoUrlPattern = /(^|[^\/])(www\.[\S]+(\b|$))/gim
  # Email addresses *** here I've changed the expression ***
  emailAddressPattern = /(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim

  html   = ""
  chunks = content.split "\n"
  for chunk in chunks when chunk isnt ''
    if chunk.indexOf("- ") is 0
      html += "<li>#{chunk.split('- ')[1]}</li>"
    else
      html += "<p>#{chunk}</p>"

  html
      .replace urlPattern, "<a #{options.linkStyle} target='_blank' href='$&'>$&</a>"
      .replace pseudoUrlPattern, "$1<a #{options.linkStyle} target='_blank' href='http://$2'>$2</a>"
      .replace emailAddressPattern, "<a #{options.linkStyle} target='_blank' href='mailto:$1'>$1</a>"
