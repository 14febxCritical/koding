// Generated by CoffeeScript 1.6.2
var ActivityAppView, ActivityListContainer,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

ActivityAppView = (function(_super) {
  var headerHeight;

  __extends(ActivityAppView, _super);

  headerHeight = 0;

  function ActivityAppView(options, data) {
    if (options == null) {
      options = {};
    }
    options.cssClass = "content-page activity";
    options.domId = "content-page-activity";
    ActivityAppView.__super__.constructor.call(this, options, data);
    this.listenWindowResize();
  }

  ActivityAppView.prototype.viewAppended = function() {
    var HomeKonstructor, entryPoint, modal,
      _this = this;

    entryPoint = KD.config.entryPoint;
    if (entryPoint === 'koding' || entryPoint === 'guest') {
      this.setClass('fixed');
    } else if ((entryPoint != null ? entryPoint.type : void 0) === 'profile') {
      this.setClass('fixed');
    }
    HomeKonstructor = entryPoint && entryPoint.type !== 'profile' ? GroupHomeView : KDCustomHTMLView;
    this.feedWrapper = new ActivityListContainer;
    this.innerNav = new ActivityInnerNavigation({
      cssClass: 'fl'
    });
    this.header = new HomeKonstructor;
    this.widget = new ActivityUpdateWidget;
    this.widgetController = new ActivityUpdateWidgetController({
      view: this.widget
    });
    this.rightBlock = new ActivityRightBlock;
    this.mainController = KD.getSingleton("mainController");
    this.mainController.on("AccountChanged", this.bound("decorate"));
    this.mainController.on("JoinedGroup", function() {
      return _this.widget.show();
    });
    this.header.bindTransitionEnd();
    this.feedWrapper.ready(function() {
      _this.activityHeader = _this.feedWrapper.controller.activityHeader;
      return _this.on('scroll', function(event) {
        if (event.delegateTarget.scrollTop > 50) {
          _this.activityHeader.setClass("scrolling-up-outset");
          return _this.activityHeader.liveUpdateButton.setValue(false);
        } else {
          _this.activityHeader.unsetClass("scrolling-up-outset");
          _this.activityHeader.liveUpdateButton.setValue(true);
          return KD.getSingleton("activityController").clearNewItemsCount();
        }
      });
    });
    this.decorate();
    this.setLazyLoader(200);
    this.header.on(["viewAppended", "ready"], function() {
      return headerHeight = _this.header.getHeight();
    });
    $(".kdview.fl.common-inner-nav, .kdview.activity-content.feeder-tabs").remove();
    this.addSubView(this.header);
    this.addSubView(this.widget);
    this.addSubView(this.innerNav);
    this.addSubView(this.rightBlock);
    this.addSubView(this.feedWrapper);
    return modal = new KDModalView({
      title: "Lorem ipsum",
      subtitle: "This is a beautiful modal window, right?",
      cssClass: "my-modal",
      overlay: true,
      content: "<p style='padding: 20px; font-size: 14px; line-height: 18px; color: #3a3a3a'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque scelerisque tempor sapien eget hendrerit. Proin auctor iaculis nunc, nec dictum ligula rhoncus quis. Curabitur vehicula mi eu justo feugiat, non pretium nisl ullamcorper. Donec at urna vehicula, iaculis mauris at, euismod odio. Morbi pharetra, arcu nec elementum egestas, tortor risus euismod velit, eget sagittis est quam porta quam. Duis at sodales nunc, a pellentesque mi.</p>"
    });
  };

  ActivityAppView.prototype.decorate = function() {
    var entryPoint, roles, _ref;

    this.unsetClass("guest");
    _ref = KD.config, entryPoint = _ref.entryPoint, roles = _ref.roles;
    if (__indexOf.call(roles, "member") < 0) {
      this.setClass("guest");
    }
    this.setClass('loggedin');
    if ((entryPoint != null ? entryPoint.type : void 0) === 'group' && __indexOf.call(roles, 'member') < 0) {
      this.widget.hide();
    } else {
      this.widget.show();
    }
    return this._windowDidResize();
  };

  ActivityAppView.prototype._windowDidResize = function() {
    if (!this.header) {
      return;
    }
    headerHeight = this.header.getHeight();
    return this.innerNav.setHeight(this.getHeight() - 77);
  };

  return ActivityAppView;

})(KDScrollView);

ActivityListContainer = (function(_super) {
  __extends(ActivityListContainer, _super);

  function ActivityListContainer(options, data) {
    var _this = this;

    if (options == null) {
      options = {};
    }
    options.cssClass = "activity-content feeder-tabs";
    ActivityListContainer.__super__.constructor.call(this, options, data);
    this.controller = new ActivityListController({
      delegate: this,
      itemClass: ActivityListItemView,
      showHeader: true
    });
    this.listWrapper = this.controller.getView();
    this.controller.ready(function() {
      return _this.emit("ready");
    });
  }

  ActivityListContainer.prototype.setSize = function(newHeight) {};

  ActivityListContainer.prototype.pistachio = function() {
    return "{{> @listWrapper}}";
  };

  return ActivityListContainer;

})(JView);
