module.exports = do->  
  afterInit:do ->
    channels = {}
    ->
      {broadcastable} = @constructor
      id = @getId?() or @bongo_?.instanceId
      if broadcastable and id?
        name = "object-#{id}"
        @channel = channels[name] or= @mq.subscribe name
        @channel.on 'updateInstance', (data)=> @update_(data)
  
  destroy:->
    return unless @channel?
    @mq.unsubscribe @channel
  
  on:(event, listener)->
    {constructor} = @    
    @channel.on event, listener

  off:(event, listener)->
    @channel.off event, listener