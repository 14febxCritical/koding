{exec}  = require "child_process"
{EventEmitter} = require "events"

class processes extends EventEmitter
  list : []
  run  : (options,callback) ->
    {restart,cmd,log,onExit}   = options
    cp = exec cmd,callback
    @list.push cmd:cmd, process : cp, pid : cp.pid
    if log
      cp.stdout.on 'data', (data) -> 
        console.log "#{data}".replace /\n+$/, ''
      cp.stderr.on 'data', (data) -> 
        console.log "#{data}".replace /\n+$/, ''
    
    cp.on 'exit', () =>
      #@emit "exit",cp.pid
      onExit cp.pid
      if restart is yes
        setTimeout (=> @run options,callback),restart
        console.log "Restarting the process in #{restart} msecs." if log

module.exports = new processes