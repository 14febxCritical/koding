mongodb = require 'mongoskin'

module.exports = class KodingLogger

  constructor:(@component, @options, @noisy)->
    {mongo, collection} = @options
    @collection = mongodb.db(mongo).collection(collection)

  logData:(type, meta, data)->
    data = data+''
    console.log data if @noisy
    @collection.insert {
      type
      meta
      data
      timestamp: new Date
      component: @component
    }

  logAll:(child, meta)->
    child.stdout?.on 'data', @logData.bind(@, 'stdout', meta)
    child.stderr?.on 'data', @logData.bind(@, 'stderr', meta)
    child.on 'exit', @logData.bind(@, 'exit', meta)