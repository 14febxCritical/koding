provides "kd_deploy"
provides "kd_deploy/deployed_revision"
provides "kd_deploy/current_dir"

cmd = "<%= @git_bin %> log --pretty=format:'%ad  %h %d' --abbrev-commit --date=short -1"

kd_deploy Mash.new unless kd_deploy
kd_deploy[:deployed_revision] = nil unless kd_deploy[:deployed_revision]
kd_deploy[:current_dir] = nil unless kd_deploy[:current_dir]

status, stdout, stderr = run_command(:no_status_check => true, :cwd => "<%= @current_dir %>/.git", :command => "#{cmd}")

if status == 0
   kd_deploy[:deployed_revision] = stdout
   kd_deploy[:current_dir] = "<%= @current_dir %>"
end
