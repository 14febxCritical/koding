##### ubuntu.common.config will be replaced with a single lxc.include with new LXC version #####
# Default pivot location
lxc.pivotdir = lxc_putold

# Default mount entries
lxc.mount.entry = proc proc proc nodev,noexec,nosuid 0 0
lxc.mount.entry = sysfs sys sysfs defaults 0 0
lxc.mount.entry = /sys/fs/fuse/connections sys/fs/fuse/connections none bind,optional 0 0
lxc.mount.entry = /sys/kernel/debug sys/kernel/debug none bind,optional 0 0
lxc.mount.entry = /sys/kernel/security sys/kernel/security none bind,optional 0 0
lxc.mount.entry = /sys/fs/pstore sys/fs/pstore none bind,optional 0 0

# Default console settings
lxc.devttydir = lxc
lxc.tty = 4
lxc.pts = 1024

# Default capabilities
lxc.cap.drop = sys_module mac_admin mac_override sys_time

# Default cgroup limits
lxc.cgroup.devices.deny = a
## Allow any mknod (but not using the node)
lxc.cgroup.devices.allow = c *:* m
lxc.cgroup.devices.allow = b *:* m
## /dev/null and zero
lxc.cgroup.devices.allow = c 1:3 rwm
lxc.cgroup.devices.allow = c 1:5 rwm
## consoles
lxc.cgroup.devices.allow = c 5:0 rwm
lxc.cgroup.devices.allow = c 5:1 rwm
## /dev/{,u}random
lxc.cgroup.devices.allow = c 1:8 rwm
lxc.cgroup.devices.allow = c 1:9 rwm
## /dev/pts/*
lxc.cgroup.devices.allow = c 5:2 rwm
lxc.cgroup.devices.allow = c 136:* rwm
## rtc
lxc.cgroup.devices.allow = c 254:0 rm
## fuse
lxc.cgroup.devices.allow = c 10:229 rwm
## tun
lxc.cgroup.devices.allow = c 10:200 rwm
## full
lxc.cgroup.devices.allow = c 1:7 rwm
## hpet
lxc.cgroup.devices.allow = c 10:228 rwm
## kvm
lxc.cgroup.devices.allow = c 10:232 rwm
## To use loop devices, copy the following line to the container's
## configuration file (uncommented).
#lxc.cgroup.devices.allow = b 7:* rwm
##### END - ubuntu.common.config #####

##### Koding specific #####
lxc.network.type = veth
lxc.network.link = lxcbr0
lxc.network.veth.pair = {{.VEth}}
lxc.network.flags = up
lxc.network.hwaddr = {{.MAC}}
lxc.network.ipv4 = {{.IP}}/9
lxc.network.ipv4.gateway = auto
lxc.network.mtu = 1450

lxc.utsname = {{.HostnameAlias}}

lxc.rootfs = /var/lib/lxc/{{.}}/rootfs

# empty by default
lxc.mount  = /var/lib/lxc/{{.}}/fstab

# disable the main console (no lxc-console from the host)
lxc.console = none

# no controlling tty at all (as we mount devpts)
lxc.tty = 0
lxc.pts = 0

# better but not possible atm: lxc.id_map = u 0 50000000 1000000
lxc.id_map = u 0 500000 500000
lxc.id_map = u 1000000 1000000 49000000

# better but not possible atm: lxc.id_map = g 0 50000000 1000000
lxc.id_map = g 0 500000 500000
lxc.id_map = g 1000000 1000000 49000000

# (noop) -  default is 1024 and this value is relative to the other containers
# could be used some day to provide QOS to paid users
# lxc.cgroup.cpu.shares = 1000
# lxc.cgroup.blkio.weight = 1000
# lxc.cgroup.cpuset.cpus = 0,1
#
#### initial limit, will be changed by limiter
lxc.cgroup.memory.soft_limit_in_bytes = 100M
lxc.cgroup.memory.limit_in_bytes = 100M

{{if swapAccountingEnabled}}
# initial limit, will be changed by limiter
lxc.cgroup.memory.memsw.limit_in_bytes = 1G
{{end}}

{{if kernelMemoryAccountingEnabled}}
# fixed limit - disabled for now as it requires new LXC to work correctly
# lxc.cgroup.memory.kmem.limit_in_bytes = 100M
{{end}}
