{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "MongoDB master",

    "Resources": {

        "VolumeMongoData0": {
            "Type": "AWS::EC2::Volume",
            "Properties": { 
                "AvailabilityZone": "us-east-1a",
                "Size": "50",
                "Tags": [
                    {"Key": "Name", "Value": "<%= role %>"  }
                ]
             }
        },
        "VolumeMongoData1": {
            "Type": "AWS::EC2::Volume",
            "Properties": { 
                "AvailabilityZone": "us-east-1a",
                "Size": "50",
                "Tags": [
                    {"Key": "Name", "Value": "<%= role %>"  }
                ]
             }
        },

        "VolumeMongoLog0": {
            "Type": "AWS::EC2::Volume",
            "Properties": { 
                "AvailabilityZone": "us-east-1a",
                "Size": "10",
                "Tags": [
                    {"Key": "Name", "Value": "<%= role %>"  }
                ]
             }
        },

        "MongoMasterInstance": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "InstanceType" : "c1.medium",
                "ImageId": "ami-3d4ff254",
                "KeyName": "koding",
                "SubnetId": "subnet-dcd019b6",
                "SecurityGroupIds": [ "sg-b17399de" ],
                "Volumes": [
                    {
                        "Device": "/dev/sdf",
                        "VolumeId": {"Ref": "VolumeMongoData0"}
                    },
                    {
                        "Device": "/dev/sdg",
                        "VolumeId": {"Ref": "VolumeMongoData1"}
                    },
                    {
                        "Device": "/dev/sdh",
                        "VolumeId": {"Ref": "VolumeMongoLog0"}
                    }

                ],
                "UserData":{"Fn::Base64": <%= bootstrap_script.to_json %>}
            }
        },
        "MongoMasterMQHostName":{
            "Type": "AWS::Route53::RecordSet",
            "Properties":{
                "HostedZoneName": "stage.aws.koding.com.",
                "Name" : "db-m0.stage.aws.koding.com.",
                "Type" : "A",
                "TTL" : "900",
                "ResourceRecords" : [ { "Fn::GetAtt" : [ "MongoMasterInstance", "PrivateIp" ] } ]
            }
        }
    },
    "Outputs":{
        "InstanceId" : {
          "Description" : "InstanceId of the newly created EC2 instance",
          "Value" : { "Ref" : "MongoMasterInstance" }
        },
        "AZ" : {
          "Description" : "Availability Zone of the newly created EC2 instance",
          "Value" : { "Fn::GetAtt" : [ "MongoMasterInstance", "AvailabilityZone" ] }
        },
        "PrivateIP" : {
          "Description" : "Private IP address of the newly created EC2 instance",
          "Value" : { "Fn::GetAtt" : [ "MongoMasterInstance", "PrivateIp" ] }
        },
        "DomainName": {
            "Description":"FQDN of newly created EC2 instamce",
            "Value": { "Ref" : "MongoMasterMQHostName"}
        }

    }
}
