{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Deploy RabbitMQ",

    "Resources": {
        "RabbitMQInstance": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "InstanceType" : "c1.medium",
                "ImageId": "ami-3d4ff254",
                "KeyName": "koding",
                "SubnetId": "subnet-dcd019b6",
                "SecurityGroupIds": [ "sg-b17399de" ],
                "UserData":{"Fn::Base64": <%= bootstrap_script.to_json %>}
            }
        },
        "RabbitMQHostName":{
            "Type": "AWS::Route53::RecordSet",
            "Properties":{
                "HostedZoneName": "stage.aws.koding.com.",
                "Name" : "rabbit.stage.aws.koding.com.",
                "Type" : "A",
                "TTL" : "900",
                "ResourceRecords" : [ { "Fn::GetAtt" : [ "RabbitMQInstance", "PrivateIp" ] } ]
            }
        }
    },
    "Outputs":{
        "InstanceId" : {
          "Description" : "InstanceId of the newly created EC2 instance",
          "Value" : { "Ref" : "RabbitMQInstance" }
        },
        "AZ" : {
          "Description" : "Availability Zone of the newly created EC2 instance",
          "Value" : { "Fn::GetAtt" : [ "RabbitMQInstance", "AvailabilityZone" ] }
        },
        "PrivateIP" : {
          "Description" : "Private IP address of the newly created EC2 instance",
          "Value" : { "Fn::GetAtt" : [ "RabbitMQInstance", "PrivateIp" ] }
        },
        "DomainName": {
            "Description":"FQDN of newly created EC2 instamce",
            "Value": { "Ref" : "RabbitMQHostName"}
        }

    }
}
