{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Deploy Active ELB for Koding web stack",
    "Resources" :{
        "WebActive":{
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "HealthCheck": {
                    "HealthyThreshold": "3",
                    "Interval":"15",
                    "Target":"TCP:3020",
                    "Timeout": "10",
                    "UnhealthyThreshold":"5"
                },
                "LBCookieStickinessPolicy":[ 
                    {
                        "CookieExpirationPeriod":"240",
                        "PolicyName": "WebSiteLBCookie"
                    }
                ],
                "Listeners": [ 
                    {
                        "InstancePort":"8080",
                        "InstanceProtocol": "HTTP",
                        "LoadBalancerPort": "80",
                        "Protocol": "HTTP"
                    },
                    {
                        "InstancePort":"80",
                        "InstanceProtocol": "HTTP",
                        "LoadBalancerPort": "443",
                        "Protocol": "HTTPS",
                        "SSLCertificateId": "arn:aws:iam::616271189586:server-certificate/kodingcom_ssl_2013_Jan_29",
                        "PolicyNames": [
                            "WebSiteLBCookie"
                        ]
                    }
                ],
                "SecurityGroups":["sg-5756a538", "sg-6a56a505"],
                "Subnets":["subnet-539f543e", "subnet-a69e55cb","subnet-979d56fa","subnet-eb9c5786"]
            }
        },

        "MqActive":{
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "Properties": {
                "HealthCheck": {
                    "HealthyThreshold": "3",
                    "Interval":"15",
                    "Target":"TCP:8008",
                    "Timeout": "10",
                    "UnhealthyThreshold":"5"
                },
                "Listeners": [ 
                    {
                        "InstancePort":"8008",
                        "InstanceProtocol": "TCP",
                        "LoadBalancerPort": "443",
                        "Protocol": "SSL",
                        "SSLCertificateId": "arn:aws:iam::616271189586:server-certificate/kodingcom_ssl_2013_Jan_29"
                    }
                ],
                "SecurityGroups":["sg-2c56a543", "sg-6a56a505"],
                "Subnets":["subnet-539f543e", "subnet-a69e55cb","subnet-979d56fa","subnet-eb9c5786"]
            }
        }


    },

    "Outputs":{
       "BrokerActiveELB": {
            "Description": "Broker's Active ELB DNS name",
            "Value": { "Fn::GetAtt": [ "MqActive", "DNSName" ] }
        },
       "WebActiveELB": {
            "Description": "WebSite Active ELB DNS name",
            "Value": { "Fn::GetAtt": [ "WebActive", "DNSName" ] }
        }
    }
   
}

